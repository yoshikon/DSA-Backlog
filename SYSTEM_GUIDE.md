# WebProd Issue Template Agent - システムガイド

## 概要
WEB制作案件のBacklog課題を効率的に起票するためのAI連携システムです。
標準テンプレートから必要な項目のみを選択し、AIが自動的に件名と詳細を生成します。

## 主要機能

### 1. 認証機能
- Supabase認証によるログイン/サインアップ
- セッション管理とセキュアなトークン処理

### 2. プロジェクト選択（SCR-PROJECT）
- Backlogプロジェクトの選択
- 課題種別、優先度、担当者の設定
- デモ用プロジェクトの自動セットアップ

### 3. テンプレート選択（SCR-TEMPLATE）
- 10セクション、60項目以上の包括的なテンプレート
- 項目ごとのチェック選択と値入力
- セクション単位での全選択/全解除
- 必須項目の自動検証
- リアルタイム選択数表示

### 4. AI生成（Edge Function）
- OpenAI GPT-4o-miniによる日本語生成
- 選択項目のみを使用した正確な生成
- 件名：30-60文字、重要キーワード優先
- 詳細：見出し + 箇条書き形式

### 5. プレビュー・編集（SCR-PREVIEW）
- AI生成結果のプレビュー表示
- 件名・詳細の手動編集機能
- 文字数カウント表示

### 6. Backlog起票（Edge Function）
- Backlog API v2を使用した課題作成
- デモモード対応（APIキー未設定時）
- カスタムフィールドマッピング対応
- エラーハンドリングとリトライ

### 7. 完了画面（SCR-POST）
- 作成された課題キーとURLの表示
- Backlog課題への直接リンク
- 新規課題作成への誘導

### 8. 管理パネル（SCR-ADMIN）
- テンプレート管理（バージョン履歴）
- プロジェクト管理
- 監査ログの閲覧
- ユーザー操作履歴の追跡

## テンプレート構成

### セクション一覧
1. **会社・案件基本** - 案件名、クライアント名、予算など
2. **サイト目的・戦略** - KPI、ターゲット、競合分析
3. **コンテンツ構成** - ページ一覧、必須コンテンツ
4. **デザイン要件** - トーン&マナー、カラー指定
5. **仕様・機能** - CMS、必須機能、SEO要件
6. **素材・権利** - ロゴ、写真、テキスト
7. **環境・インフラ** - ドメイン、サーバ、セキュリティ
8. **運用・保守** - 更新体制、保守範囲
9. **スケジュール** - フェーズ計画、マイルストーン
10. **参照・添付** - Figma、仕様書、参考URL

### 項目タイプ
- **text**: 1行テキスト入力
- **textarea**: 複数行テキスト入力
- **select**: 選択肢から1つ選択
- **checkbox**: 複数選択可能

## 使用方法

### 初回セットアップ
1. アカウント作成（メールアドレス + パスワード）
2. ログイン

### 課題作成フロー
1. **プロジェクト選択**
   - 対象プロジェクトを選択
   - 課題種別（タスク/バグ/要望/その他）
   - 優先度（低/中/高）
   - 担当者メールアドレス（任意）

2. **テンプレート選択**
   - 必要な項目をチェック
   - 各項目に値を入力
   - 必須項目は必ず入力
   - 「AIで件名・詳細を生成する」をクリック

3. **プレビュー・編集**
   - AI生成結果を確認
   - 必要に応じて手動編集
   - 「Backlogに起票する」をクリック

4. **完了**
   - 課題キーとURLを確認
   - Backlogで詳細を確認
   - 「新しい課題を作成」で次の課題へ

## セキュリティ機能

### データベースセキュリティ
- Row Level Security (RLS) 有効化
- ユーザー単位のアクセス制御
- 認証済みユーザーのみアクセス可能

### 監査ログ
- すべての課題生成を記録
- AI生成のパラメータを保存
- ユーザーID、タイムスタンプを記録
- 操作履歴の完全な追跡

### 認証
- Supabase Auth による安全な認証
- JWT トークンベースのセッション管理
- HTTPSによる通信の暗号化

## Edge Functions

### generate-issue-content
- **パス**: `/functions/v1/generate-issue-content`
- **メソッド**: POST
- **認証**: 必須（JWT）
- **入力**: selectedItems, template
- **出力**: summary, description

### create-backlog-issue
- **パス**: `/functions/v1/create-backlog-issue`
- **メソッド**: POST
- **認証**: 必須（JWT）
- **入力**: projectId, summary, description, issueType, priority, assignee
- **出力**: issueKey, issueUrl

## 環境変数

以下の環境変数が自動設定されます：

### フロントエンド (.env)
- `VITE_SUPABASE_URL` - Supabase プロジェクトURL
- `VITE_SUPABASE_ANON_KEY` - Supabase 匿名キー

### Edge Functions（自動設定）
- `SUPABASE_URL` - Supabase URL
- `SUPABASE_SERVICE_ROLE_KEY` - サービスロールキー
- `OPENAI_API_KEY` - OpenAI APIキー（AI生成用）
- `BACKLOG_API_KEY` - Backlog APIキー（任意、デモモードで動作可能）

## デモモード

Backlog APIキーが設定されていない場合、デモモードで動作します：
- 疑似的な課題キーを生成（例：WEBPROD-1234567890）
- 疑似的なBacklog URLを生成
- データベースには正常に記録される
- AI生成は実際のOpenAI APIを使用

## トラブルシューティング

### AI生成が失敗する
- OpenAI APIキーが正しく設定されているか確認
- 選択項目が空でないか確認
- ネットワーク接続を確認

### Backlog起票が失敗する
- プロジェクトIDが正しいか確認
- Backlog APIキーが正しく設定されているか確認
- デモモードでの動作を試す

### ログインできない
- メールアドレスとパスワードを確認
- アカウントが作成済みか確認
- ブラウザのキャッシュをクリア

## 技術スタック

- **フロントエンド**: React 18 + TypeScript + Vite
- **スタイリング**: Tailwind CSS
- **アイコン**: Lucide React
- **データベース**: Supabase PostgreSQL
- **認証**: Supabase Auth
- **バックエンド**: Supabase Edge Functions (Deno)
- **AI**: OpenAI GPT-4o-mini
- **外部連携**: Backlog API v2

## パフォーマンス指標

### 目標値
- AI生成応答時間: < 2秒（平均）
- Backlog起票時間: < 1秒（平均）
- 起票所要時間: 15分 → 5分
- テンプレート準拠率: 60% → 95%

## 今後の拡張予定

- Slackモーダルからの直接起票
- Notion規約RAG参照機能
- Webhookによる課題更新通知
- カスタムテンプレートの作成機能
- チーム別テンプレート管理
- 統計ダッシュボード

## サポート

システムに関する問い合わせは、管理パネルの監査ログを確認の上、
システム管理者までお問い合わせください。
